# Self-Hosting

Run OpenFolio on your own infrastructure using Docker Compose.

## Prerequisites

- Docker and Docker Compose
- An OpenAI API key (for embeddings and AI features)
- (Optional) Google and Microsoft OAuth credentials for contact source sync

## Quick Start

```bash
# 1. Clone the repository
git clone https://github.com/unlatch-ai/OpenFolio.git
cd openfolio

# 2. Run the setup script
./scripts/setup.sh

# 3. Add your API keys
nano .env
# Set OPENAI_API_KEY=sk-...

# 4. Start all services
docker compose up -d

# 5. Visit http://localhost:3000
```

The setup script generates:
- `POSTGRES_PASSWORD` — random database password
- `JWT_SECRET` — for Supabase Auth tokens
- `INTEGRATION_ENCRYPTION_KEY` — for encrypting stored OAuth tokens
- Sets `OPENFOLIO_MODE=self-hosted` and `NEXT_PUBLIC_OPENFOLIO_MODE=self-hosted`
- Self-host defaults to no-auth single-user behavior (no additional mode vars required)

## Services

| Service | Port | Description |
|---------|------|-------------|
| `app` | 3000 | OpenFolio Next.js application |
| `db` | — | PostgreSQL 16 with pgvector |
| `auth` | 9999 | Supabase Auth (GoTrue) |
| `rest` | 3001 | PostgREST API |

## Initial Setup

1. Visit http://localhost:3000
2. OpenFolio auto-bootstraps a local singleton user + personal workspace on first app/API request
3. You are routed straight into `/app` (no signup/login/onboarding screens)
4. Start importing contacts or connecting integrations

## OAuth Integrations

For Google and Microsoft connectors in self-hosted mode:
- The instance admin configures OAuth client credentials once.
- Users connect via the UI and grant consent.
- OpenFolio exchanges and stores encrypted tokens automatically.
- Users do not manually create tokens.

Setup guides:
- [Google OAuth Setup](/docs/self-hosting/google-oauth)
- [Microsoft OAuth Setup](/docs/self-hosting/microsoft-oauth)

## Self-Hosted Behavior

- Auth mode defaults to `none` in self-hosted deployments
- Team/members/invite management is disabled
- Billing checks are disabled
- Recommended deployment model is private network/VPN/reverse proxy auth if internet exposed

## Updating

```bash
git pull
docker compose build app
docker compose up -d
```

Database migrations are applied automatically when the database container starts.

## Data Persistence

PostgreSQL data is stored in a Docker volume (`pgdata`). To back up:

```bash
docker compose exec db pg_dump -U postgres openfolio > backup.sql
```

To restore:

```bash
docker compose exec -T db psql -U postgres openfolio < backup.sql
```
